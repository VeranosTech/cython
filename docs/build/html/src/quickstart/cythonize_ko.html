
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>정적 타이핑(static typing)을 이용한 빠른 코드 &#8212; 싸이선(Cython) 0.28a0 documentation</title>
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.28a0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="튜토리얼" href="../tutorial/index_ko.html" />
    <link rel="prev" title="싸이선(Cython) 코드 빌드" href="build_ko.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../tutorial/index_ko.html" title="튜토리얼"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="build_ko.html" title="싸이선(Cython) 코드 빌드"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index_ko.html">싸이선(Cython) 0.28a0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index_ko.html" accesskey="U">시작하기</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="static-typing">
<h1>정적 타이핑(static typing)을 이용한 빠른 코드<a class="headerlink" href="#static-typing" title="Permalink to this headline">¶</a></h1>
<p>Cython is a Python compiler.  This means that it can compile normal
Python code without changes (with a few obvious exceptions of some as-yet
unsupported language features).  However, for performance critical
code, it is often helpful to add static type declarations, as they
will allow Cython to step out of the dynamic nature of the Python code
and generate simpler and faster C code - sometimes faster by orders of
magnitude.</p>
<p>It must be noted, however, that type declarations can make the source
code more verbose and thus less readable.  It is therefore discouraged
to use them without good reason, such as where benchmarks prove
that they really make the code substantially faster in a performance
critical section. Typically a few types in the right spots go a long way.</p>
<p>All C types are available for type declarations: integer and floating
point types, complex numbers, structs, unions and pointer types.
Cython can automatically and correctly convert between the types on
assignment.  This also includes Python’s arbitrary size integer types,
where value overflows on conversion to a C type will raise a Python
<code class="docutils literal"><span class="pre">OverflowError</span></code> at runtime.  (It does not, however, check for overflow
when doing arithmetic.) The generated C code will handle the
platform dependent sizes of C types correctly and safely in this case.</p>
<p>Types are declared via the cdef keyword.</p>
<div class="section" id="typing-variables">
<h2>Typing Variables<a class="headerlink" href="#typing-variables" title="Permalink to this headline">¶</a></h2>
<p>Consider the following pure Python code:</p>
<div class="highlight-cython"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mf">2</span><span class="o">-</span><span class="n">x</span>

<span class="k">def</span> <span class="nf">integrate_f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mf">0</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">N</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">dx</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span> <span class="o">*</span> <span class="n">dx</span>
</pre></div>
</div>
<p>Simply compiling this in Cython merely gives a 35% speedup.  This is
better than nothing, but adding some static types can make a much larger
difference.</p>
<p>With additional type declarations, this might look like:</p>
<div class="highlight-cython"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">double</span> <span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mf">2</span><span class="o">-</span><span class="n">x</span>

<span class="k">def</span> <span class="nf">integrate_f</span><span class="p">(</span><span class="n">double</span> <span class="n">a</span><span class="p">,</span> <span class="n">double</span> <span class="n">b</span><span class="p">,</span> <span class="nb">int</span> <span class="n">N</span><span class="p">):</span>
    <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span>
    <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">s</span><span class="p">,</span> <span class="nf">dx</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mf">0</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">N</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">dx</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span> <span class="o">*</span> <span class="n">dx</span>
</pre></div>
</div>
<p>Since the iterator variable <code class="docutils literal"><span class="pre">i</span></code> is typed with C semantics, the for-loop will be compiled
to pure C code.  Typing <code class="docutils literal"><span class="pre">a</span></code>, <code class="docutils literal"><span class="pre">s</span></code> and <code class="docutils literal"><span class="pre">dx</span></code> is important as they are involved
in arithmetic within the for-loop; typing <code class="docutils literal"><span class="pre">b</span></code> and <code class="docutils literal"><span class="pre">N</span></code> makes less of a
difference, but in this case it is not much extra work to be
consistent and type the entire function.</p>
<p>This results in a 4 times speedup over the pure Python version.</p>
</div>
<div class="section" id="typing-functions">
<h2>Typing Functions<a class="headerlink" href="#typing-functions" title="Permalink to this headline">¶</a></h2>
<p>Python function calls can be expensive – in Cython doubly so because
one might need to convert to and from Python objects to do the call.
In our example above, the argument is assumed to be a C double both inside f()
and in the call to it, yet a Python <code class="docutils literal"><span class="pre">float</span></code> object must be constructed around the
argument in order to pass it.</p>
<p>Therefore Cython provides a syntax for declaring a C-style function,
the cdef keyword:</p>
<div class="highlight-cython"><div class="highlight"><pre><span></span><span class="k">cdef</span> <span class="kt">double</span> <span class="nf">f</span><span class="p">(</span><span class="n">double</span> <span class="n">x</span><span class="p">)</span> <span class="k">except</span><span class="o">?</span> <span class="o">-</span><span class="mf">2</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mf">2</span><span class="o">-</span><span class="n">x</span>
</pre></div>
</div>
<p>Some form of except-modifier should usually be added, otherwise Cython
will not be able to propagate exceptions raised in the function (or a
function it calls). The <code class="docutils literal"><span class="pre">except?</span> <span class="pre">-2</span></code> means that an error will be checked
for if <code class="docutils literal"><span class="pre">-2</span></code> is returned (though the <code class="docutils literal"><span class="pre">?</span></code> indicates that <code class="docutils literal"><span class="pre">-2</span></code> may also
be used as a valid return value).
Alternatively, the slower <code class="docutils literal"><span class="pre">except</span> <span class="pre">*</span></code> is always
safe. An except clause can be left out if the function returns a Python
object or if it is guaranteed that an exception will not be raised
within the function call.</p>
<p>A side-effect of cdef is that the function is no longer available from
Python-space, as Python wouldn’t know how to call it. It is also no
longer possible to change <code class="xref py py-func docutils literal"><span class="pre">f()</span></code> at runtime.</p>
<p>Using the <code class="docutils literal"><span class="pre">cpdef</span></code> keyword instead of <code class="docutils literal"><span class="pre">cdef</span></code>, a Python wrapper is also
created, so that the function is available both from Cython (fast, passing
typed values directly) and from Python (wrapping values in Python
objects). In fact, <code class="docutils literal"><span class="pre">cpdef</span></code> does not just provide a Python wrapper, it also
installs logic to allow the method to be overridden by python methods, even
when called from within cython. This does add a tiny overhead compared to <code class="docutils literal"><span class="pre">cdef</span></code>
methods.</p>
<p>Speedup: 150 times over pure Python.</p>
</div>
<div class="section" id="determining-where-to-add-types">
<h2>Determining where to add types<a class="headerlink" href="#determining-where-to-add-types" title="Permalink to this headline">¶</a></h2>
<p>Because static typing is often the key to large speed gains, beginners
often have a tendency to type everything in sight. This cuts down on both
readability and flexibility, and can even slow things down (e.g. by adding
unnecessary type checks, conversions, or slow buffer unpacking).
On the other hand, it is easy to kill
performance by forgetting to type a critical loop variable. Two essential
tools to help with this task are profiling and annotation.
Profiling should be the first step of any optimization effort, and can
tell you where you are spending your time. Cython’s annotation can then
tell you why your code is taking time.</p>
<p>Using the <code class="docutils literal"><span class="pre">-a</span></code> switch to the <code class="docutils literal"><span class="pre">cython</span></code> command line program (or
following a link from the Sage notebook) results in an HTML report
of Cython code interleaved with the generated C code.  Lines are
colored according to the level of “typedness” –
white lines translate to pure C,
while lines that require the Python C-API are yellow
(darker as they translate to more C-API interaction).
Lines that translate to C code have a plus (<code class="docutils literal"><span class="pre">+</span></code>) in front
and can be clicked to show the generated code.</p>
<p>This report is invaluable when optimizing a function for speed,
and for determining when to <a class="reference internal" href="../userguide/external_C_code.html#nogil"><span class="std std-ref">release the GIL</span></a>:
in general, a <code class="docutils literal"><span class="pre">nogil</span></code> block may contain only “white” code.</p>
<div class="figure">
<img alt="../../_images/htmlreport.png" src="../../_images/htmlreport.png" />
</div>
<p>Note that Cython deduces the type of local variables based on their assignments
(including as loop variable targets) which can also cut down on the need to
explicitly specify types everywhere.
For example, declaring <code class="docutils literal"><span class="pre">dx</span></code> to be of type double above is unnecessary,
as is declaring the type of <code class="docutils literal"><span class="pre">s</span></code> in the last version (where the return type
of <code class="docutils literal"><span class="pre">f</span></code> is known to be a C double.)  A notable exception, however, is
<em>integer types used in arithmetic expressions</em>, as Cython is unable to ensure
that an overflow would not occur (and so falls back to <code class="docutils literal"><span class="pre">object</span></code> in case
Python’s bignums are needed).  To allow inference of C integer types, set the
<code class="docutils literal"><span class="pre">infer_types</span></code> <a class="reference internal" href="../reference/compilation.html#compiler-directives"><span class="std std-ref">directive</span></a> to <code class="docutils literal"><span class="pre">True</span></code>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index_ko.html">
              <img class="logo" src="../../_static/cythonlogo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../index_ko.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">정적 타이핑(static typing)을 이용한 빠른 코드</a><ul>
<li><a class="reference internal" href="#typing-variables">Typing Variables</a></li>
<li><a class="reference internal" href="#typing-functions">Typing Functions</a></li>
<li><a class="reference internal" href="#determining-where-to-add-types">Determining where to add types</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="build_ko.html"
                        title="previous chapter">싸이선(Cython) 코드 빌드</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../tutorial/index_ko.html"
                        title="next chapter">튜토리얼</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/src/quickstart/cythonize_ko.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../tutorial/index_ko.html" title="튜토리얼"
             >next</a></li>
        <li class="right" >
          <a href="build_ko.html" title="싸이선(Cython) 코드 빌드"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index_ko.html">싸이선(Cython) 0.28a0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index_ko.html" >시작하기</a> &#187;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Stefan Behnel, Robert Bradshaw, Dag Sverre Seljebotn, Greg Ewing, William Stein, Gabriel Gellner, et al..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-6139100-3");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>